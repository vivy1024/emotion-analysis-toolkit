# Requirements: UI 界面全面升级（Phase 2）

## Introduction

当前 UI 使用固定 QGridLayout 布局，6个面板硬编码位置，无法调整大小或隐藏。视觉风格为基础暗色主题，缺乏数据可视化。用户明确要求"UI界面很丑，面板应该做成多面板可选择"。

**目标**: 打造专业级实时情绪分析工作台，支持可停靠面板、数据可视化、录制回放。

**优先级**: P1

**代码位置**: `D:\pycharm2\PythonProject2\hidden_emotion_cpp\`

## Requirements

### REQ-1: QDockWidget 可停靠面板系统 [P0]
- 所有面板改为 QDockWidget，支持拖拽、停靠、浮动、隐藏
- 面板列表：视频流、人脸裁剪、宏表情、微表情、AU分析、隐藏情绪、意图分析、时序图、性能监控
- 菜单栏"视图"菜单：勾选/取消勾选控制面板显示
- 支持保存/恢复布局（QSettings 持久化 QMainWindow::saveState/restoreState）
- 预设布局：默认（全部显示）、精简（仅视频+隐藏情绪）、分析（全部分析面板）

### REQ-2: 数据可视化面板 [P0]
- **情绪概率柱状图**: 替换 QProgressBar 为 QPainter 自绘柱状图，带动画过渡
- **AU 雷达图**: 蛛网图显示 AU 激活强度，中心为0，外圈为最大强度
- **情绪时序折线图**: 最近60秒的情绪概率变化曲线（7条线，对应7种情绪）
- **意图时间线**: 横轴时间，纵轴意图类型，用色块标记不同意图模式
- 所有图表支持鼠标悬停显示数值 tooltip

### REQ-3: 视觉风格升级 [P1]
- 统一配色方案：深色背景 #0a0a1a，面板背景 #12122a，强调色 #00d4ff（青色）
- 面板标题栏自定义样式（渐变背景 + 图标）
- 情绪类型配色：Happiness=#FFD700, Sadness=#4169E1, Anger=#FF4444, Fear=#9B59B6, Disgust=#2ECC71, Surprise=#FF8C00, Neutral=#888888
- 字体：等宽字体用于数值显示，比例字体用于标签
- 圆角边框、微妙阴影效果

### REQ-4: 交互功能 [P1]
- 视频面板右键菜单：截图保存、切换摄像头、调整分辨率
- 面板右键菜单：重置位置、最大化/还原
- 快捷键：Space=暂停/恢复, S=截图, R=录制, F=全屏, 1-9=切换预设布局
- 状态栏：FPS + 检测人脸数 + 当前意图模式 + 录制状态

### REQ-5: 录制与回放 [P2]
- 录制功能：将视频帧 + 分析结果序列化保存为 .hed 文件
- 回放功能：加载 .hed 文件，按原始帧率回放，支持暂停/快进/后退
- 导出功能：将分析结果导出为 CSV（时间戳, 宏表情, 微表情, 意图, 置信度...）

### REQ-6: 灵敏度控制面板 [P1]
- 滑块控制：检测阈值、冲突阈值、AU验证严格度、时序窗口大小
- 实时生效，无需重启
- 显示当前自适应阈值 τ 的实时值

## Out of Scope
- 3D 人脸渲染（过于复杂，收益低）
- 多语言国际化（当前仅中文）
- 远程流媒体输入（仅本地摄像头 + 文件回放）

## Dependencies
- Phase 1 算法升级完成（HiddenEmotionResult 新字段、IntentionType 枚举）
- Qt6 Charts 模块（如果可用）或纯 QPainter 自绘
