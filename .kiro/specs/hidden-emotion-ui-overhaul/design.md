# Design: UI ç•Œé¢å…¨é¢å‡çº§ï¼ˆPhase 2ï¼‰

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        QMainWindow                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ QMenuBar: æ–‡ä»¶ | è§†å›¾(é¢æ¿å‹¾é€‰) | å·¥å…· | å¸®åŠ©           â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ QToolBar: â–¶å¼€å§‹ â¸æš‚åœ â¹åœæ­¢ ğŸ“·æˆªå›¾ ğŸ”´å½•åˆ¶ âš™è®¾ç½®     â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ QDockWidget  â”‚ â”‚ QDockWidget  â”‚ â”‚ QDockWidget  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ è§†é¢‘æµé¢æ¿   â”‚ â”‚ å®è¡¨æƒ…é¢æ¿   â”‚ â”‚ AUé›·è¾¾å›¾     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ (Central)    â”‚ â”‚ (Right-Top)  â”‚ â”‚ (Right-Bot)  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚              â”‚ â”‚ æŸ±çŠ¶å›¾+æ ‡ç­¾  â”‚ â”‚ è››ç½‘å›¾       â”‚   â”‚    â”‚
â”‚  â”‚  â”‚              â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚    â”‚
â”‚  â”‚  â”‚              â”‚ â”‚ QDockWidget  â”‚ â”‚ QDockWidget  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚              â”‚ â”‚ å¾®è¡¨æƒ…é¢æ¿   â”‚ â”‚ éšè—æƒ…ç»ªé¢æ¿ â”‚   â”‚    â”‚
â”‚  â”‚  â”‚              â”‚ â”‚ æŸ±çŠ¶å›¾+æ ‡ç­¾  â”‚ â”‚ æ„å›¾+D-S     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ QDockWidget: æƒ…ç»ªæ—¶åºæŠ˜çº¿å›¾ (Bottom)            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ 60ç§’æ»‘åŠ¨çª—å£ï¼Œ7æ¡æƒ…ç»ªæ›²çº¿                       â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ QStatusBar: FPS:12 | äººè„¸:1 | æ„å›¾:æ©é¥° | â—REC 00:32  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ–‡ä»¶ç»“æ„å˜æ›´

```
hidden_emotion_cpp/
â”œâ”€â”€ include/ui/
â”‚   â”œâ”€â”€ main_window.h              # é‡æ„ï¼šQDockWidget ç®¡ç†
â”‚   â”œâ”€â”€ panels.h                   # ä¿ç•™ï¼šVideoPanel, FacePanel
â”‚   â”œâ”€â”€ emotion_panel.h            # é‡æ„ï¼šè‡ªç»˜æŸ±çŠ¶å›¾
â”‚   â”œâ”€â”€ au_radar_panel.h           # æ–°å¢ï¼šAU è››ç½‘é›·è¾¾å›¾
â”‚   â”œâ”€â”€ timeline_panel.h           # æ–°å¢ï¼šæƒ…ç»ªæ—¶åºæŠ˜çº¿å›¾
â”‚   â”œâ”€â”€ intention_panel.h          # æ–°å¢ï¼šæ„å›¾åˆ†æé¢æ¿
â”‚   â”œâ”€â”€ hidden_emotion_panel.h     # é‡æ„ï¼šé›†æˆ D-S ä¿¡æ¯
â”‚   â”œâ”€â”€ sensitivity_panel.h        # æ–°å¢ï¼šçµæ•åº¦æ§åˆ¶é¢æ¿
â”‚   â”œâ”€â”€ chart_widgets.h            # æ–°å¢ï¼šè‡ªç»˜å›¾è¡¨åŸºç±»ï¼ˆBarChart, RadarChart, LineChartï¼‰
â”‚   â””â”€â”€ theme.h                    # æ–°å¢ï¼šç»Ÿä¸€é…è‰²/å­—ä½“å¸¸é‡
â”œâ”€â”€ src/ui/
â”‚   â”œâ”€â”€ main_window.cpp            # é‡æ„
â”‚   â”œâ”€â”€ panels.cpp                 # ä¿ç•™
â”‚   â”œâ”€â”€ emotion_panel.cpp          # é‡æ„
â”‚   â”œâ”€â”€ au_radar_panel.cpp         # æ–°å¢
â”‚   â”œâ”€â”€ timeline_panel.cpp         # æ–°å¢
â”‚   â”œâ”€â”€ intention_panel.cpp        # æ–°å¢
â”‚   â”œâ”€â”€ hidden_emotion_panel.cpp   # é‡æ„
â”‚   â”œâ”€â”€ sensitivity_panel.cpp      # æ–°å¢
â”‚   â””â”€â”€ chart_widgets.cpp          # æ–°å¢
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ icons/                     # å·¥å…·æ å›¾æ ‡ (SVG)
â”‚   â””â”€â”€ styles/theme.qss          # Qt æ ·å¼è¡¨
â””â”€â”€ CMakeLists.txt                 # æ›´æ–°
```

## è‡ªç»˜å›¾è¡¨è®¾è®¡

### BarChartï¼ˆæƒ…ç»ªæ¦‚ç‡æŸ±çŠ¶å›¾ï¼‰
```cpp
class BarChart : public QWidget {
    // QPainter è‡ªç»˜ï¼Œä¸ä¾èµ– Qt Charts
    // æ”¯æŒåŠ¨ç”»è¿‡æ¸¡ï¼ˆQPropertyAnimation é©±åŠ¨ current_values â†’ target_valuesï¼‰
    // æ¯ä¸ªæŸ±å­é¢œè‰²å¯¹åº”æƒ…ç»ªç±»å‹é…è‰²
    // é¼ æ ‡æ‚¬åœæ˜¾ç¤º tooltip
};
```

### RadarChartï¼ˆAU è››ç½‘å›¾ï¼‰
```cpp
class RadarChart : public QWidget {
    // å¤šè¾¹å½¢è››ç½‘èƒŒæ™¯ï¼ˆ5å±‚åŒå¿ƒå¤šè¾¹å½¢ï¼‰
    // æ•°æ®ç‚¹è¿çº¿ + åŠé€æ˜å¡«å……
    // è½´æ ‡ç­¾ä¸º AU ç¼–å·
    // æ”¯æŒå¤šç»„æ•°æ®å åŠ ï¼ˆå¦‚æ ¸å¿ƒAUçº¢è‰²ã€è¾…åŠ©AUè“è‰²ï¼‰
};
```

### LineChartï¼ˆæ—¶åºæŠ˜çº¿å›¾ï¼‰
```cpp
class LineChart : public QWidget {
    // 60ç§’æ»‘åŠ¨çª—å£
    // 7æ¡æ›²çº¿å¯¹åº”7ç§æƒ…ç»ªï¼Œå„è‡ªé…è‰²
    // çºµè½´ 0~1 æ¦‚ç‡ï¼Œæ¨ªè½´æ—¶é—´
    // æ”¯æŒå›¾ä¾‹æ˜¾ç¤º/éšè—
    // é¼ æ ‡æ‚¬åœæ˜¾ç¤ºåå­—çº¿ + æ•°å€¼
};
```

## é…è‰²æ–¹æ¡ˆ (theme.h)

```cpp
namespace hed::ui::theme {
    // èƒŒæ™¯
    constexpr QColor kBgPrimary   = QColor(0x0a, 0x0a, 0x1a);  // #0a0a1a
    constexpr QColor kBgSecondary = QColor(0x12, 0x12, 0x2a);  // #12122a
    constexpr QColor kBgPanel     = QColor(0x1a, 0x1a, 0x2e);  // #1a1a2e
    constexpr QColor kBgHover     = QColor(0x16, 0x21, 0x3e);  // #16213e

    // å¼ºè°ƒè‰²
    constexpr QColor kAccent      = QColor(0x00, 0xd4, 0xff);  // #00d4ff é’è‰²
    constexpr QColor kAccentDim   = QColor(0x00, 0x8b, 0xb5);  // æš—é’è‰²

    // æƒ…ç»ªé…è‰²
    constexpr QColor kHappiness   = QColor(0xFF, 0xD7, 0x00);  // é‡‘è‰²
    constexpr QColor kSadness     = QColor(0x41, 0x69, 0xE1);  // çš‡å®¶è“
    constexpr QColor kAnger       = QColor(0xFF, 0x44, 0x44);  // çº¢è‰²
    constexpr QColor kFear        = QColor(0x9B, 0x59, 0xB6);  // ç´«è‰²
    constexpr QColor kDisgust     = QColor(0x2E, 0xCC, 0x71);  // ç»¿è‰²
    constexpr QColor kSurprise    = QColor(0xFF, 0x8C, 0x00);  // æ©™è‰²
    constexpr QColor kNeutral     = QColor(0x88, 0x88, 0x88);  // ç°è‰²

    // æ–‡å­—
    constexpr QColor kTextPrimary = QColor(0xe0, 0xe0, 0xe0);
    constexpr QColor kTextDim     = QColor(0x88, 0x88, 0x88);
}
```

## å¸ƒå±€æŒä¹…åŒ–

```cpp
// ä¿å­˜å¸ƒå±€
void MainWindow::saveLayout(const QString& name) {
    QSettings settings("HED", "HiddenEmotionDetector");
    settings.setValue("layouts/" + name + "/geometry", saveGeometry());
    settings.setValue("layouts/" + name + "/state", saveState());
}

// æ¢å¤å¸ƒå±€
void MainWindow::restoreLayout(const QString& name) {
    QSettings settings("HED", "HiddenEmotionDetector");
    restoreGeometry(settings.value("layouts/" + name + "/geometry").toByteArray());
    restoreState(settings.value("layouts/" + name + "/state").toByteArray());
}
```

## Testing Strategy

- è§†è§‰æµ‹è¯•ï¼šæˆªå›¾å¯¹æ¯”ï¼Œç¡®è®¤é…è‰²æ–¹æ¡ˆä¸€è‡´
- äº¤äº’æµ‹è¯•ï¼šæ‹–æ‹½é¢æ¿ã€æµ®åŠ¨ã€åœé ã€éšè—ã€æ¢å¤
- æ€§èƒ½æµ‹è¯•ï¼šå›¾è¡¨åˆ·æ–°ä¸å½±å“å¸§ç‡ï¼ˆQPainter ç»‘å®š 30fps åˆ·æ–°ï¼Œç‹¬ç«‹äºè§†é¢‘å¸§ç‡ï¼‰
- å¸ƒå±€æŒä¹…åŒ–ï¼šå…³é—­é‡å¼€åå¸ƒå±€æ¢å¤æ­£ç¡®
