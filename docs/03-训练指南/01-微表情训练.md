# 微表情训练指南

## 概述

微表情识别采用两阶段训练：CNN 提取空间特征 → LSTM 建模时序关系。

## Stage 1: CNN 特征提取器

配置文件：`micro_expression/config_cnn_stage1.yaml`

```bash
python -m micro_expression.train_cnn --config micro_expression/config_cnn_stage1.yaml
```

输出：`stage1_cnn_output/` 下的 `.pth` 权重文件和训练曲线。

关键模块：
- `models.py` — CNNModel 架构定义
- `dataset.py` — 图像数据加载
- `transforms.py` — 数据增强

## 特征提取

配置文件：`micro_expression/config_feature_extraction.yaml`

```bash
python -m micro_expression.extract_features --config micro_expression/config_feature_extraction.yaml
```

用训练好的 CNN 对图像序列提取特征向量。

## Stage 2: LSTM 时序模型

配置文件：`micro_expression/config_lstm_stage2.yaml`

```bash
python -m micro_expression.train_lstm --config micro_expression/config_lstm_stage2.yaml
```

关键模块：
- `models.py` — LSTMOnlyModel 架构定义
- `feature_dataset.py` — 特征序列数据加载
- `utils.py` — MICRO_EMOTION_MAP、NUM_CLASSES 等常量

使用 StratifiedGroupKFold 交叉验证，输出在 `stage2_lstm_output/`。

## 超参数搜索

```bash
python -m micro_expression.hpo_train --config micro_expression/config_lstm_stage2.yaml
```

## 配置文件说明

所有训练参数通过 YAML 配置控制，包括：
- 数据集路径、批大小、学习率
- 模型结构参数（隐藏层维度、层数等）
- 训练策略（epoch数、早停、学习率调度）
